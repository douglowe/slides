<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>f2py: Fortran for Python</title>

		<meta name="description" content="How and why for f2py. PythonNW, July 2018">
		<meta name="author" content="Douglas Lowe">


		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">		
			<div class="slides">

<!-- ##### introduction slides ##### -->
				<section>
					<section>
						<h2>Atmospheric Models using Fortran and Python</h2>
						<!--<h3>How and why for f2py</h3>-->
						<p>
							<small><a href="http://douglowe.github.io">Douglas Lowe</a> (University of Manchester)</small>
						</p>
					</section>

					<section>
						<h3>Schedule</h3>
						<ul>
							<li>Atmospheric Science Background</li>
							<li>Brief history of Atmospheric Modelling</li>
							<li>Fortran vs Python</li>
							<li>Example Atmospheric Models</li>
							<li>f2py under the hood</li>
						</ul>
					</section>

				</section>

				<section>
					<section>
						<h3>introduction to atmos science</h3>
						<p>general info on areas of interest</p>
					</section>

					<section>
						<p> followed by pages on specific details we are interested in (gas-phase chemistry, radiative transfer)</p>
					</section>

				</section>


				<section>
					<section>
						<h3>introduction to atmospheric modelling</h3>
						<p>general info on history of atmos modelling, languages used, etc</p>
					</section>
					
					<section>
						<p>followed by specific examples of work we've been involved in</p>
					</section>

					<section>
						<p>specific example of evolution of solutions: facsimile to kpp to python</p>
						<p>(possibly move this to later section?)</p>
					</section>					
				</section>


				<section>
					<section>
						<h3>language choice: fortran vs python?</h3>
					</section>

					<section>
						<h3>sociological reasons</h3>
						<ul>
							<li>code inheritance</li>
							<li>language support - what are colleagues using?</li>
						</ul>
					</section>
					
					<section>
						<h3>Fortran Pros/Cons (as I see them)</h3>
		
						<p>Pros:</p>				
						<ul>
							<li>speed</li>
							<li>maths focus</li>
						</ul>

						<p>Cons:</p>
						<ul>
							<li>limited ways of organising data (no dictionaries)</li>
							<li>text processing is a nightmare</li>
						</ul>

					</section>
					
					<section>
						<h3>Python Pros/Cons (as I see them)</h3>
						
						<p>Pros:</p>
						<ul>
							<li>flexibility</li>
							<li>good syntax? easy to code?</li>
							<li></li>
						</ul>
						
						<p>Cons:</p>
						<ul>
							<li>computational efficiency</li>
							<ul>
								<li>speed (but numba?!? more on this later...)</li>
								<li>parallelisation</li>
							</ul>
						</ul>
						
					</section>
				
					<section>
						<h3>Solution: use both with f2py</h3>
						<ul>
							<li>Fortran to Python interface generator</li>
							<li>Part of <a href="http://www.numpy.org/">NumPy</a> (numpy.f2py)</li>
							<li>Also a standalone command line tool when numpy is installed</li>
							<li>More documentation at <a href="https://docs.scipy.org/doc/numpy/f2py/">SciPy</a></li>
						</ul>
						<ul>
							<li>Reuse old/legacy code - save time and avoid (new) errors</li>
							<li>Computational efficiency, for heavyweight mathematical code</li>
						</ul>
					</section>
				
					<section>
						<h3>Confession time:</h3>
						<p>I don't actually use python for my everyday work...</p>
					</section>
				
				</section>


				<section>
					<h3>Example Atmospheric Models</h3>
					<ul>
						<li>Climate modelling: <a href="https://github.com/brian-rose/climlab">climlab</a></li>
						<p>(Brian E. J. Rose, University at Albany, USA)</p>
						<li>Gas chemistry box model: <a href="https://github.com/loftytopping/PyBox">PyBox</a></li> 
						<p>(<a href="http://davidtoppingsci.com/">David Topping</a>, University of Manchester)<p>
						<li>Aerosol chemistry box model: <a href="https://github.com/douglowe/f2py-manic-demo">MANIC</a></li>
					</ul>
				</section>



				<section>
					<section>
						<h2><a href="https://github.com/brian-rose/climlab">climlab</a></h2>
						<p>
							<small>Created by Brian E. J. Rose (University at Albany, USA)</small>
						</p>
					</section>

					<section>
						<h3>Installation Instructions</h3>
					</section>

					<section>
						<h3>Examples</h3>
					</section>


				</section>



				<section>
					<section>
						<h2><a href="https://github.com/loftytopping/PyBox">PyBox</a></h2>
						<p>
							<small>Created by <a href="http://davidtoppingsci.com/">David Topping</a></small>
						</p>
					</section>

					<section>
						<h3>Installation Instructions</h3>
					</section>

					<section>
						<h3>Examples</h3>
					</section>


				</section>



				<section>
					
					<section>
						<h2><a href="https://github.com/douglowe/f2py-manic-demo">MANIC</a></h2>
						<p>
							<small>Created by <a href="http://douglowe.github.io/">Douglas Lowe</a></small>
						</p>
					</section>

					<section>
						<h3>Installation Instructions</h3>
					</section>
					
					<section>
						<h3>Examples</h3>
					</section>
					
					
				</section>












<!-- ##### basic usage slides ##### -->
				<section>
					
					<section>
						<h2>Basic Usage</h2>
						<p>
							simple usage case from <a href="https://docs.scipy.org/doc/numpy/f2py/getting-started.html">https://docs.scipy.org/doc/numpy/f2py/getting-started.html</a>
						</p>
					</section>


					<section>
						<h2>Fortran 77 code</h2>					
						<pre><code class="fortran">
      SUBROUTINE FIB(A,N)
C     CALCULATE FIRST N FIBONACCI NUMBERS
      INTEGER N
      REAL*8 A(N)
      DO I=1,N
         IF (I.EQ.1) THEN
            A(I) = 0.0D0
         ELSEIF (I.EQ.2) THEN
            A(I) = 1.0D0
         ELSE 
            A(I) = A(I-1) + A(I-2)
         ENDIF
      ENDDO
      END
						</code></pre>
					</section>

					
					<section>
						<h4>Quick Compile & Import</h4>
<!--						<p>Compile python module</p> -->
						<pre><code class="unix">
f2py -c fib1.f -m fib1						
						</code></pre>
<!--						<p>load module in python session</p> -->
						<pre><code class="python">
&gt;&gt;&gt; import numpy
&gt;&gt;&gt; import fib1
&gt;&gt;&gt; print fib1.fib.__doc__
fib - Function signature:
  fib(a,[n])
Required arguments:
  a : input rank-1 array('d') with bounds (n)
Optional arguments:
  n := len(a) input int
						</code></pre>
						<p><small>Note the optional argument defined by f2py; in pure fortran both arguments would be required</small></p>

					</section>	
					
					<section>
						<h4>Quick Usage</h4>
						<pre><code class="python">
&gt;&gt;&gt; a = numpy.zeros(8,'d')
&gt;&gt;&gt; fib1.fib(a)
&gt;&gt;&gt; print a
[  0.   1.   1.   2.   3.   5.   8.  13.]
						</code></pre>
						<p><small>predefined numpy array is returned with fibonnaci series</small></p>
					</section>


					<section>
						<h4>Quick Problems</h4>
						<pre><code class="python">
&gt;&gt;&gt; a1 = numpy.zeros(8,'d')
&gt;&gt;&gt; fib1.fib(a1,6)
&gt;&gt;&gt; print a1
[ 0.  1.  1.  2.  3.  5.  0.  0.]
						</code></pre>

						<pre><code class="python">
&gt;&gt;&gt; fib1.fib(a,10)
fib:n=10
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in ?
fib.error: (len(a)&gt;=n) failed for 1st keyword n
&gt;&gt;&gt; 
						</code></pre>
						<p><small>Allowing users to define 'n' themselves leads to problems when it doesn't match the array size</small></p>

					</section>


				</section>


<!-- ##### advanced usage slides ##### -->

				<section>
					<h2>Advanced Usage</h2>
				</section>


<!-- ##### example usage slides - real(?) world usage of f2py ##### -->




			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
